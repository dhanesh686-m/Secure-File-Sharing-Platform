<!-- templates/my_files.html -->
{% extends "base.html" %}

{% block title %}My Files{% endblock %}

{% block content %}
<h1 class="text-4xl font-extrabold text-white mb-8 text-center">My Uploaded Files</h1>

{% if files_with_links %}
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        {% for item in files_with_links %}
            <div class="bg-gray-800 rounded-lg shadow-xl p-6 border-l-4 border-blue-500">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h2 class="text-2xl font-bold text-white">{{ item.file.original_filename }}</h2>
                        <p class="text-gray-400 text-sm">Uploaded: {{ item.file.upload_date.strftime('%Y-%m-%d %H:%M UTC') }}</p>
                    </div>
                    <form action="{{ url_for('delete_file', file_id=item.file.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this file and all its links?');">
                        <button type="submit" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md text-sm transition duration-300 shadow-md">
                            Delete File
                        </button>
                    </form>
                </div>

                <h3 class="text-xl font-semibold text-gray-300 mb-3">Share Links:</h3>
                {% if item.links %}
                    <ul class="space-y-3 mb-4">
                        {% for link in item.links %}
                            <li class="bg-gray-700 p-4 rounded-md flex justify-between items-center shadow-inner">
                                <div>
                                    <p class="text-blue-400 text-sm break-all">
                                        <a href="{{ url_for('download_file_via_link', token=link.access_token, _external=True) }}" target="_blank" class="hover:underline">
                                            {{ url_for('download_file_via_link', token=link.access_token, _external=True) }}
                                        </a>
                                    </p>
                                    <p class="text-gray-400 text-xs mt-1">
                                        {% if link.expires_at %}
                                            Expires: {{ link.expires_at.strftime('%Y-%m-%d %H:%M UTC') }}
                                        {% else %}
                                            No expiration
                                        {% endif %}
                                        | Downloads: {{ link.current_downloads }}
                                        {% if link.max_downloads %}
                                            / {{ link.max_downloads }}
                                        {% else %}
                                            (Unlimited)
                                        {% endif %}
                                    </p>
                                </div>
                                <form action="{{ url_for('delete_link', link_id=link.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this link?');">
                                    <button type="submit" class="bg-red-500 hover:bg-red-600 text-white py-1 px-3 rounded-md text-xs transition duration-300">
                                        Delete
                                    </button>
                                </form>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-gray-400 mb-4">No active share links for this file.</p>
                {% endif %}

                <div class="mt-4 text-center">
                    <a href="{{ url_for('generate_link', file_id=item.file.id) }}"
                       class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-5 rounded-md transition duration-300 shadow-md">
                        Generate New Link
                    </a>
                </div>
            </div>
        {% endfor %}
    </div>
{% else %}
    <div class="text-center py-10">
        <p class="text-xl text-gray-400 mb-6">You haven't uploaded any files yet.</p>
        <a href="{{ url_for('upload_file') }}" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-md transition duration-300 shadow-lg">
            Upload Your First File
        </a>
    </div>
{% endif %}
{% endblock %}
